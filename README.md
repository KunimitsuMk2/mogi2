<h1>ãƒ•ãƒªãƒã‚¢ãƒ—ãƒª</h1>

<h2>ğŸ“‹ å†æå‡ºå¯¾å¿œå†…å®¹</h2>

<h3>ğŸ”§ ä¸»è¦ãªä¿®æ­£ãƒ»æ”¹å–„ç‚¹</h3>

<h4>1. Stripeæ±ºæ¸ˆæ©Ÿèƒ½ã®å®Œå…¨å®Ÿè£…</h4>
<ul>
<li><strong>ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ</strong>: Stripe Checkoutã®æ±ºæ¸ˆç”»é¢ã«æ­£ã—ãé·ç§»ã™ã‚‹ã‚ˆã†ä¿®æ­£</li>
<li><strong>ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆ</strong>: PaymentIntentã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆã‚’å®Ÿè£…</li>
<li><strong>è¦ä»¶å¯¾å¿œ</strong>: FN023ã€ŒStripeã®æ±ºæ¸ˆç”»é¢ã«æ¥ç¶šã•ã‚Œã‚‹ã€ã‚’å®Œå…¨å®Ÿè£…</li>
<li>æ±ºæ¸ˆå®Œäº†å¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç™»éŒ²ã¨å•†å“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚’å®Ÿè£…</li>
</ul>

<h4>2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çµ±ä¸€</h4>
<ul>
<li>ä¼šå“¡ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦ä»¶é€šã‚Šã«ä¿®æ­£</li>
<li>ä½æ‰€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å½¢å¼ã‚’çµ±ä¸€ï¼ˆéƒµä¾¿ç•ªå·å½¢å¼ç­‰ï¼‰</li>
<li>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ </li>
<li>å•†å“å‡ºå“æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¼ã‚’ä¿®æ­£</li>
</ul>

<h4>3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼æ”¹å–„</h4>
<ul>
<li>ä¼šå“¡ç™»éŒ²å¾Œã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šç”»é¢é·ç§»ã‚’å®Ÿè£…ï¼ˆFN006å¯¾å¿œï¼‰</li>
<li>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–å‡¦ç†ã‚’å¼·åŒ–</li>
<li>è³¼å…¥å®Œäº†å¾Œã®é©åˆ‡ãªç”»é¢é·ç§»ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º</li>
</ul>

<h4>4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã®æ”¹å–„</h4>
<ul>
<li><code>purchases</code>ãƒ†ãƒ¼ãƒ–ãƒ«ã«<code>stripe_payment_id</code>ã‚«ãƒ©ãƒ ã‚’è¿½åŠ </li>
<li>å•†å“çŠ¶æ…‹ã®å‹çµ±ä¸€ï¼ˆæ•°å€¤å®šæ•°ã«çµ±ä¸€ï¼‰</li>
<li>Purchase.phpãƒ¢ãƒ‡ãƒ«ã®fillableå±æ€§ã¨ã‚­ãƒ£ã‚¹ãƒˆè¨­å®šã‚’ä¿®æ­£</li>
</ul>

<h4>5. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®æ”¹å–„</h4>
<ul>
<li>Stripeæ±ºæ¸ˆã«å¯¾å¿œã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«ä¿®æ­£</li>
<li>å®Ÿéš›ã®APIé€šä¿¡ã‚’é¿ã‘ã‚‹ãƒ¢ãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè£…</li>
<li>å…¨79ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒæ­£å¸¸ã«é€šéã™ã‚‹ã“ã¨ã‚’ç¢ºèª</li>
</ul>

<h2>ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ</h2>

### ERå›³

```mermaid
erDiagram
    users ||--o{ items : "å‡ºå“"
    users ||--o{ purchases : "è³¼å…¥"
    users ||--o{ comments : "ã‚³ãƒ¡ãƒ³ãƒˆ"
    users ||--o{ favorites : "ãŠæ°—ã«å…¥ã‚Š"
    
    items ||--o{ purchases : "è³¼å…¥ã•ã‚Œã‚‹"
    items ||--o{ comments : "ã‚³ãƒ¡ãƒ³ãƒˆã•ã‚Œã‚‹"
    items ||--o{ favorites : "ãŠæ°—ã«å…¥ã‚Šã•ã‚Œã‚‹"
    items ||--o{ category_item : "å±ã™ã‚‹"
    
    categories ||--o{ category_item : "å«ã‚€"

    users {
        bigint id PK
        varchar name
        varchar email
        timestamp email_verified_at
        varchar password
        varchar avatar
        varchar postal_code
        varchar address
        varchar building_name
        varchar remember_token
        timestamp created_at
        timestamp updated_at
    }

    items {
        bigint id PK
        varchar name
        text description
        varchar brand
        integer price
        varchar image_url
        varchar condition
        bigint seller_id FK
        varchar status
        timestamp created_at
        timestamp updated_at
    }

    purchases {
        bigint id PK
        bigint user_id FK
        bigint item_id FK
        integer quantity
        integer price
        varchar payment_method
        varchar stripe_payment_id
        varchar shipping_postal_code
        text shipping_address
        varchar shipping_building_name
        varchar status
        timestamp purchased_at
        timestamp created_at
        timestamp updated_at
    }

    categories {
        bigint id PK
        varchar name
        timestamp created_at
        timestamp updated_at
    }

    category_item {
        bigint id PK
        bigint category_id FK
        bigint item_id FK
        timestamp created_at
        timestamp updated_at
    }

    favorites {
        bigint id PK
        bigint user_id FK
        bigint item_id FK
        timestamp created_at
        timestamp updated_at
    }

    comments {
        bigint id PK
        bigint user_id FK
        bigint item_id FK
        text content
        timestamp created_at
        timestamp updated_at
    }
```

<h3>ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§</h3>

<h4>users ãƒ†ãƒ¼ãƒ–ãƒ«</h4>
<table border="1">
<tr><th>ã‚«ãƒ©ãƒ å</th><th>å‹</th><th>èª¬æ˜</th></tr>
<tr><td>id</td><td>bigint</td><td>ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆä¸»ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>name</td><td>varchar(255)</td><td>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</td></tr>
<tr><td>email</td><td>varchar(255)</td><td>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰</td></tr>
<tr><td>email_verified_at</td><td>timestamp</td><td>ãƒ¡ãƒ¼ãƒ«èªè¨¼æ—¥æ™‚</td></tr>
<tr><td>password</td><td>varchar(255)</td><td>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆãƒãƒƒã‚·ãƒ¥åŒ–ï¼‰</td></tr>
<tr><td>avatar</td><td>varchar(255)</td><td>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒãƒ‘ã‚¹</td></tr>
<tr><td>postal_code</td><td>varchar(255)</td><td>éƒµä¾¿ç•ªå·</td></tr>
<tr><td>address</td><td>varchar(255)</td><td>ä½æ‰€</td></tr>
<tr><td>building_name</td><td>varchar(255)</td><td>å»ºç‰©å</td></tr>
<tr><td>remember_token</td><td>varchar(100)</td><td>ãƒ­ã‚°ã‚¤ãƒ³ä¿æŒãƒˆãƒ¼ã‚¯ãƒ³</td></tr>
<tr><td>created_at</td><td>timestamp</td><td>ä½œæˆæ—¥æ™‚</td></tr>
<tr><td>updated_at</td><td>timestamp</td><td>æ›´æ–°æ—¥æ™‚</td></tr>
</table>

<h4>items ãƒ†ãƒ¼ãƒ–ãƒ«</h4>
<table border="1">
<tr><th>ã‚«ãƒ©ãƒ å</th><th>å‹</th><th>èª¬æ˜</th></tr>
<tr><td>id</td><td>bigint</td><td>å•†å“IDï¼ˆä¸»ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>name</td><td>varchar(255)</td><td>å•†å“å</td></tr>
<tr><td>description</td><td>text</td><td>å•†å“èª¬æ˜</td></tr>
<tr><td>brand</td><td>varchar(255)</td><td>ãƒ–ãƒ©ãƒ³ãƒ‰å</td></tr>
<tr><td>price</td><td>integer</td><td>ä¾¡æ ¼</td></tr>
<tr><td>image_url</td><td>varchar(255)</td><td>å•†å“ç”»åƒURL</td></tr>
<tr><td>condition</td><td>varchar(255)</td><td>å•†å“çŠ¶æ…‹</td></tr>
<tr><td>seller_id</td><td>bigint</td><td>å‡ºå“è€…IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>status</td><td>varchar(255)</td><td>å•†å“çŠ¶æ…‹ï¼ˆavailable/soldï¼‰</td></tr>
<tr><td>created_at</td><td>timestamp</td><td>ä½œæˆæ—¥æ™‚</td></tr>
<tr><td>updated_at</td><td>timestamp</td><td>æ›´æ–°æ—¥æ™‚</td></tr>
</table>

<h4>purchases ãƒ†ãƒ¼ãƒ–ãƒ«</h4>
<table border="1">
<tr><th>ã‚«ãƒ©ãƒ å</th><th>å‹</th><th>èª¬æ˜</th></tr>
<tr><td>id</td><td>bigint</td><td>è³¼å…¥IDï¼ˆä¸»ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>user_id</td><td>bigint</td><td>è³¼å…¥è€…IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>item_id</td><td>bigint</td><td>å•†å“IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>quantity</td><td>integer</td><td>è³¼å…¥æ•°é‡</td></tr>
<tr><td>price</td><td>integer</td><td>è³¼å…¥ä¾¡æ ¼</td></tr>
<tr><td>payment_method</td><td>varchar(255)</td><td>æ”¯æ‰•ã„æ–¹æ³•</td></tr>
<tr><td>stripe_payment_id</td><td>varchar(255)</td><td>Stripeæ±ºæ¸ˆID</td></tr>
<tr><td>shipping_postal_code</td><td>varchar(255)</td><td>é…é€å…ˆéƒµä¾¿ç•ªå·</td></tr>
<tr><td>shipping_address</td><td>text</td><td>é…é€å…ˆä½æ‰€</td></tr>
<tr><td>shipping_building_name</td><td>varchar(255)</td><td>é…é€å…ˆå»ºç‰©å</td></tr>
<tr><td>status</td><td>varchar(255)</td><td>è³¼å…¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</td></tr>
<tr><td>purchased_at</td><td>timestamp</td><td>è³¼å…¥æ—¥æ™‚</td></tr>
<tr><td>created_at</td><td>timestamp</td><td>ä½œæˆæ—¥æ™‚</td></tr>
<tr><td>updated_at</td><td>timestamp</td><td>æ›´æ–°æ—¥æ™‚</td></tr>
</table>

<h4>categories ãƒ†ãƒ¼ãƒ–ãƒ«</h4>
<table border="1">
<tr><th>ã‚«ãƒ©ãƒ å</th><th>å‹</th><th>èª¬æ˜</th></tr>
<tr><td>id</td><td>bigint</td><td>ã‚«ãƒ†ã‚´ãƒªIDï¼ˆä¸»ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>name</td><td>varchar(255)</td><td>ã‚«ãƒ†ã‚´ãƒªå</td></tr>
<tr><td>created_at</td><td>timestamp</td><td>ä½œæˆæ—¥æ™‚</td></tr>
<tr><td>updated_at</td><td>timestamp</td><td>æ›´æ–°æ—¥æ™‚</td></tr>
</table>

<h4>category_item ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰</h4>
<table border="1">
<tr><th>ã‚«ãƒ©ãƒ å</th><th>å‹</th><th>èª¬æ˜</th></tr>
<tr><td>id</td><td>bigint</td><td>IDï¼ˆä¸»ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>category_id</td><td>bigint</td><td>ã‚«ãƒ†ã‚´ãƒªIDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>item_id</td><td>bigint</td><td>å•†å“IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>created_at</td><td>timestamp</td><td>ä½œæˆæ—¥æ™‚</td></tr>
<tr><td>updated_at</td><td>timestamp</td><td>æ›´æ–°æ—¥æ™‚</td></tr>
</table>

<h4>favorites ãƒ†ãƒ¼ãƒ–ãƒ«</h4>
<table border="1">
<tr><th>ã‚«ãƒ©ãƒ å</th><th>å‹</th><th>èª¬æ˜</th></tr>
<tr><td>id</td><td>bigint</td><td>IDï¼ˆä¸»ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>user_id</td><td>bigint</td><td>ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>item_id</td><td>bigint</td><td>å•†å“IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>created_at</td><td>timestamp</td><td>ä½œæˆæ—¥æ™‚</td></tr>
<tr><td>updated_at</td><td>timestamp</td><td>æ›´æ–°æ—¥æ™‚</td></tr>
</table>

<h4>comments ãƒ†ãƒ¼ãƒ–ãƒ«</h4>
<table border="1">
<tr><th>ã‚«ãƒ©ãƒ å</th><th>å‹</th><th>èª¬æ˜</th></tr>
<tr><td>id</td><td>bigint</td><td>ã‚³ãƒ¡ãƒ³ãƒˆIDï¼ˆä¸»ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>user_id</td><td>bigint</td><td>ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>item_id</td><td>bigint</td><td>å•†å“IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰</td></tr>
<tr><td>content</td><td>text</td><td>ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹</td></tr>
<tr><td>created_at</td><td>timestamp</td><td>ä½œæˆæ—¥æ™‚</td></tr>
<tr><td>updated_at</td><td>timestamp</td><td>æ›´æ–°æ—¥æ™‚</td></tr>
</table>

<h2>ç’°å¢ƒæ§‹ç¯‰</h2>
Dockerãƒ“ãƒ«ãƒ‰</br>
1 git clone ãƒªãƒ³ã‚¯</br>
2 docker-compose up -d --build</br>
MySQLã¯ã€OSã«ã‚ˆã£ã¦èµ·å‹•ã—ãªã„å ´åˆãŒã‚ã‚‹ã®ã§ãã‚Œãã‚Œã®PCã«åˆã‚ã›ã¦docker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ã€‚</br>

<h2>Laravelé–‹ç™ºç’°å¢ƒ</h2>
ã€€
1 docker-compose exec php bash</br>
2 composer install</br>
3 .env.exampleãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰.envã‚’ä½œæˆã—ã€ç’°å¢ƒå¤‰æ•°ã‚’å¤‰æ›´</br>
4 php artisan key:generate</br>
5 php artisan migrate</br>
6 php artisan db:seed</br>

<h3>ğŸ”‘ Stripeè¨­å®šï¼ˆé‡è¦ï¼‰</h3>
.envãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®Stripeè¨­å®šã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼š
<pre>
# Stripeè¨­å®š
STRIPE_PUBLIC_KEY="pk_test_xxxxxx"
STRIPE_SECRET_KEY="sk_test_xxxxxx"
</pre>

<h2>ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
<pre>
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker-compose exec php php artisan test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker-compose exec php php artisan test tests/Feature/PurchaseTest.php
</pre>

<h2>ä½¿ç”¨æŠ€è¡“</h2>
PHP 8.4.4</br>
Laravel 8.83.8</br>
MySQL 8.02.6</br>
<strong>Stripe API</strong> (æ±ºæ¸ˆå‡¦ç†)</br>

<h2>ğŸŒŸ ä¸»è¦æ©Ÿèƒ½</h2>
<ul>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ï¼ˆä¼šå“¡ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰</li>
<li>å•†å“ä¸€è¦§ãƒ»è©³ç´°è¡¨ç¤º</li>
<li>å•†å“æ¤œç´¢æ©Ÿèƒ½</li>
<li>å•†å“å‡ºå“æ©Ÿèƒ½</li>
<li>ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½</li>
<li>ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½</li>
<li><strong>Stripeæ±ºæ¸ˆæ©Ÿèƒ½ï¼ˆã‚«ãƒ¼ãƒ‰ãƒ»ã‚³ãƒ³ãƒ“ãƒ‹ï¼‰</strong></li>
<li>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†</li>
<li>è³¼å…¥å±¥æ­´ç®¡ç†</li>
</ul>

<h2>URL</h2>
é–‹ç™ºç’°å¢ƒ: http://localhost/</br>
phpMyAdmin: http://localhost:8080/

<h2>ğŸ“ å‚™è€ƒ</h2>
<ul>
<li>æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ†ã‚¹ãƒˆç’°å¢ƒç”¨ã§ã™</li>
<li>Stripeæ±ºæ¸ˆã¯ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™</li>
<li>å®Ÿéš›ã®æ±ºæ¸ˆã¯ç™ºç”Ÿã—ã¾ã›ã‚“</li>
<li>å…¨79ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒæ­£å¸¸ã«é€šéã™ã‚‹ã“ã¨ã‚’ç¢ºèªæ¸ˆã¿</li>
</ul>
